{% comment %}
TSS – Horizontal Shoppable Reels
Instagram Style Carousel
No controls
No hover autoplay
Desktop arrows included
Updated 2026
{% endcomment %}

{% stylesheet %}
.tss-reels {
  background: var(--tss-bg);
  padding: var(--tss-padding-top) 20px var(--tss-padding-bottom);
  position: relative;
}

.tss-reels__container {
  max-width: var(--tss-max-width);
  margin: 0 auto;
  position: relative;
}

/* TRACK */
.tss-reels__track {
  display: flex;
  gap: 20px;
  overflow-x: auto;
  scroll-behavior: smooth;
  scrollbar-width: none;
}

.tss-reels__track::-webkit-scrollbar {
  display: none;
}

/* CARD */
.tss-reel {
  flex: 0 0 240px;
  position: relative;
}

.tss-reel-card {
  border-radius: 20px;
  overflow: hidden;
  position: relative;
  background: #000;
  box-shadow: 0 10px 30px rgba(0,0,0,0.15);
}

/* VIDEO */
.tss-reel-video {
  aspect-ratio: 9 / 16;
  width: 100%;
}

.tss-reel-video video {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* PRODUCT OVERLAY */
.tss-reel-product {
  position: absolute;
  bottom: 10px;
  left: 10px;
  right: 10px;
  background: #fff;
  border-radius: 14px;
  padding: 10px;
  display: flex;
  align-items: center;
  gap: 8px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.2);
}

.tss-reel-product img {
  width: 36px;
  height: 36px;
  border-radius: 8px;
  object-fit: cover;
}

.tss-reel-product-info {
  flex: 1;
}

.tss-reel-product-title {
  font-size: 12px;
  font-weight: 600;
  line-height: 1.2;
}

.tss-reel-product-price {
  font-size: 12px;
  color: #666;
}

.tss-reel-add {
  background: #000;
  color: #fff;
  border: none;
  padding: 6px 10px;
  border-radius: 8px;
  font-size: 11px;
  cursor: pointer;
}

/* ARROWS */
.tss-reel-arrow {
  position: absolute;
  top: 45%;
  transform: translateY(-50%);
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: none;
  background: rgba(0,0,0,0.6);
  color: #fff;
  font-size: 18px;
  cursor: pointer;
  z-index: 5;
}

.tss-reel-arrow.left {
  left: -10px;
}

.tss-reel-arrow.right {
  right: -10px;
}

@media (max-width: 768px) {
  .tss-reel {
    flex: 0 0 200px;
  }

  .tss-reel-arrow {
    display: none;
  }
}
{% endstylesheet %}

<section
  class="tss-reels"
  style="
    --tss-bg: {{ section.settings.bg_color }};
    --tss-max-width: {{ section.settings.max_width }}px;
    --tss-padding-top: {{ section.settings.padding_top }}px;
    --tss-padding-bottom: {{ section.settings.padding_bottom }}px;
  "
>
  <div class="tss-reels__container">

    <button class="tss-reel-arrow left">‹</button>
    <button class="tss-reel-arrow right">›</button>

    <div class="tss-reels__track">
      {% for block in section.blocks %}
        {% if block.settings.video and block.settings.product %}
          <div class="tss-reel" {{ block.shopify_attributes }}>
            <div class="tss-reel-card">

              <div class="tss-reel-video">
                {{ block.settings.video | video_tag: autoplay: true, loop: true, muted: true, controls: false, playsinline: true }}
              </div>

              <div class="tss-reel-product">
                <img src="{{ block.settings.product.featured_image | img_url: '100x100' }}">
                
                <div class="tss-reel-product-info">
                  <div class="tss-reel-product-title">
                    {{ block.settings.product.title }}
                  </div>
                  <div class="tss-reel-product-price">
                    {{ block.settings.product.price | money }}
                  </div>
                </div>

                <button 
                  class="tss-reel-add"
                  data-variant-id="{{ block.settings.product.selected_or_first_available_variant.id }}">
                  +
                </button>

              </div>

            </div>
          </div>
        {% endif %}
      {% endfor %}
    </div>

  </div>
</section>

<script>
  /* FORCE AUTOPLAY SAFELY */
section.querySelectorAll('video').forEach(video => {
  video.muted = true;
  video.play().catch(() => {});
});
(function () {
  const section = document.getElementById('shopify-section-{{ section.id }}');
  if (!section) return;

  const track = section.querySelector('.tss-reels__track');
  const left = section.querySelector('.tss-reel-arrow.left');
  const right = section.querySelector('.tss-reel-arrow.right');

  /* Arrow Scroll */
  left.addEventListener('click', () => {
    track.scrollBy({ left: -300, behavior: 'smooth' });
  });

  right.addEventListener('click', () => {
    track.scrollBy({ left: 300, behavior: 'smooth' });
  });

  /* AJAX ADD TO CART */
  section.addEventListener('click', function (e) {
    const btn = e.target.closest('.tss-reel-add');
    if (!btn) return;

    fetch('/cart/add.js', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        id: btn.dataset.variantId,
        quantity: 1
      })
    });
  });

})();
</script>

{% schema %}
{
  "name": "TSS Reels",
  "settings": [
    { "type": "color", "id": "bg_color", "label": "Background Color", "default": "#f3f3f3" },
    { "type": "range", "id": "max_width", "label": "Section Max Width (px)", "min": 900, "max": 1600, "step": 50, "default": 1400 },
    { "type": "range", "id": "padding_top", "label": "Padding Top (px)", "min": 20, "max": 150, "step": 5, "default": 60 },
    { "type": "range", "id": "padding_bottom", "label": "Padding Bottom (px)", "min": 20, "max": 150, "step": 5, "default": 60 }
  ],
  "blocks": [
    {
      "type": "reel",
      "name": "Video + Product",
      "settings": [
        { "type": "video", "id": "video", "label": "Upload Video" },
        { "type": "product", "id": "product", "label": "Select Product" }
      ]
    }
  ],
  "presets": [
    {
      "name": "TSS Reels",
      "blocks": [
        { "type": "reel" },
        { "type": "reel" },
        { "type": "reel" },
        { "type": "reel" },
        { "type": "reel" }
      ]
    }
  ]
}
{% endschema %}
